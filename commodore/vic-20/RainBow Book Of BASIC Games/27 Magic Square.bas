100 REM MAGIC
110 GOSUB 1100
120 PRINT "{space*3}magic square"
130 LET T=2:GOSUB 1400:GOSUB 2800
140 LET N=1:LET C=1
150 DIM A(4,4)
160 DIM C(4,4)
170 FOR J=1 TO 4
180 FOR K=1 TO 4
190 LET C(J,K)=0
200 NEXT K
210 NEXT J
220 FOR J=1 TO 4
230 FOR K=1 TO 4
240 LET A(J,K)=(J-1)*4+K+N-1
250 NEXT K
260 NEXT J
270 FOR J=1 TO 2
280 LET Z=A(J,J):LET A(J,J)=A(5-J,5-J)
290 LET A(5-J,5-J)=Z:LET Z=A(J,5-J)
300 LET A(J,5-J)=A(5-J,J):LET A(5-J,J)=Z
310 NEXT J
320 LET C(1,1)=A(1,1)
330 LET C(1,3)=A(1,3)
340 LET C(1,4)=A(1,4)
350 LET C(2,2)=A(2,2)
360 LET C(3,2)=A(3,2)
370 LET C(3,3)=A(3,3)
380 LET C(4,1)=A(4,1)
390 GOSUB 2800
400 LET X=5:LET Y=0:GOSUB 1700
410 PRINT "a{space*3}b{space*3}c{space*3}d"
420 FOR J=1 TO 4
430 LET Y=2+3*(J-1)
440 FOR K=1 TO 4
450 LET X=4*K+1:IF C(J,K)>9 THEN LET X=X-1
460 GOSUB 1700:PRINT; C(J,K)
470 NEXT K
480 NEXT J
490 LET X=0
500 FOR J=1 TO 4
510 LET Y=2+3*(J-1):GOSUB 1700:PRINT STR$(J);
520 NEXT J:IF C=0 THEN GOTO 700
530 LET X=0:LET Y=13:GOSUB 1700:PRINT "column{space*2}row{space*2}number"
540 LET X=0:LET Y=14:GOSUB 1700
550 GOSUB 2200:LET C$=K$
560 IF C$="a" THEN LET C=1
570 IF C$="b" THEN LET C=2
580 IF C$="c" THEN LET C=3
590 IF C$="d" THEN LET C=4
600 LET X=8:GOSUB 1700:GOSUB 2100:LET R=K
610 LET X=15:GOSUB 1700:GOSUB 2100:LET N=K
620 IF A(R,C)=N THEN LET C(R,C)=A(R,C)
630 LET C=0
640 FOR J=1 TO 4
650 FOR K=1 TO 4
660 IF C(J,K)=0 THEN LET C=1
670 NEXT K
680 NEXT J
690 GOTO 390
700 STOP
1000 REM VIC20 SUBROUTINES
1100 W=20:D=23
1110 F=8:GOSUB 1200:RETURN
1200 PRINT CHR$(147)
1210 FOR LL=1 TO 8:PRINT:NEXT LL
1220 PRINT;
1230 RETURN
1300 R=INT(RND(1)*N+1):RETURN
1400 FOR Z=1 TO 1000*T:NEXT Z:RETURN
1500 GET G$:IF G$="" THEN 1500
1510 RETURN
1600 GET K$:RETURN
1700 PRINT CHR$(19)
1710 IF Y>0 THEN FOR LL=1 TO Y:PRINT CHR$(17);:NEXT LL
1720 IF X>0 THEN FOR LL=1 TO X:PRINT CHR$(29);:NEXT LL
1730 RETURN
1800 IF X>0 THEN FOR LL=1 TO X:PRINT CHR$(29);:NEXT LL
1810 RETURN
1900 PRINT CHR$(145);:RETURN
2000 PRINT CHR$(29);:RETURN
2100 INPUT K:RETURN
2200 INPUT K$:RETURN
2300 PRINT CHR$(147):RETURN
2400 POKE 36878,15:POKE 36876,Z+128
2410 FOR M=1 TO 50:NEXT M
2420 POKE 36876,0:RETURN
2500 R$=CHR$(R+64):RETURN
2600 P$=MID$(K$,P,1):RETURN
2700 GOSUB 2600:A=ASC(P$):RETURN
2800 PRINT CHR$(147):RETURN
2900 DIM V$(26):RETURN
3000 DIM W$(60):RETURN
3100 GG=ASC(G$):RETURN
